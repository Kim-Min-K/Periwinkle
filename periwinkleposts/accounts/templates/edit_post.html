{% extends "base.html" %}

{% block title %}Edit Post{% endblock %}
{% block content %}
<div class="max-w-2xl mx-auto mt-8 p-6 bg-white rounded-lg shadow">
    <h2 class="text-2xl font-bold mb-6 text-center">Edit Post</h2>
    
    <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        
        <div class="mb-4">
            <label class="block text-gray-700 mb-2">Title</label>
            <input type="text" name="title" value="{{ post.title }}"
                   class="w-full px-3 py-2 border rounded-lg">
        </div>

        <div class="mb-4">
            <label class="block text-gray-700 mb-2">Description</label>
            <textarea name="description"
                      class="w-full px-3 py-2 border rounded-lg">{{ post.description }}</textarea>
        </div>

        <div class="mb-4">
            <label class="block text-gray-700 mb-2">Content</label>
            <textarea name="content"
                      class="w-full px-3 py-2 border rounded-lg h-32">{{ post.content }}</textarea>
        </div>

        <div class="mb-6">
            <label class="block text-gray-700 mb-2">Visibility</label>
            <select name="visibility" class="w-full px-3 py-2 border rounded-lg">
                {% for value, label in visibility_choices %}
                <option value="{{ value }}" {% if post.visibility == value %}selected{% endif %}>
                    {{ label }}
                </option>
                {% endfor %}
            </select>
        </div>

        <!-- Image upload input -->
        <div class="mb-4">
            <label class="block text-gray-700 mb-2">Image</label>
            <input type="file" name="image" id="image" accept="image/*" class="w-full px-3 py-2 border rounded-lg">
            <img id="imagePreview" src="{{ post.image.url }}" alt="Current Image"
                 class="max-w-[100px] max-h-[100px] {% if post.image %}block{% else %}hidden{% endif %}">
        </div>
        
        <!-- Video upload input -->
        <div class="mb-4">
            <label class="block text-gray-700 mb-2">Video</label>
            <input type="file" name="video" id="videoInput" accept="video/*"  class="w-full px-3 py-2 border rounded-lg">
            {% if post.video %}
            <video controls style="max-width: 200px;">
                <source src="{{ post.video.url }}" type="video/mp4">
            </video>
            {% endif %}
        </div>

        <div class="flex justify-end gap-4">
            <button type="submit" 
                    class="px-4 py-2 bg-[#CCCCFF] text-white rounded-lg hover:bg-[#8585e6] transition-colors">
                Save Changes
            </button>
        </div>
    </form>
</div>
<script>
    // This is changing the image view when uploading a new image
    document.getElementById('image').addEventListener('change', function(event) {
        const [file] = event.target.files;
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }
    });
    // <!--This is for the video input to see if the video is valid (less the 4 seconds) if not it will alert user-->

    document.getElementById('videoInput').addEventListener('change', function (event) {
        const file = event.target.files[0];
        if (file) {
            const video = document.createElement('video');
            video.preload = 'metadata';

            video.onloadedmetadata = function () {
                window.URL.revokeObjectURL(video.src);
                if (video.duration > 4) {
                    alert('Video must be 4 seconds or less');
                    event.target.value = '';  // Clear the file input
                }
            };

            video.src = URL.createObjectURL(file);
        }
    });

    document.querySelector('form').onsubmit = function (event) {
        const videoInput = document.getElementById('videoInput');
        if (videoInput.files.length > 0 && video.duration > 4) {
            event.preventDefault();  // Stop form submission
            alert('Please upload a video that is 4 seconds or less.');
        }
    };
</script>
{% endblock %}